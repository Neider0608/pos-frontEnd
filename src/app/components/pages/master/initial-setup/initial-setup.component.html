<div class="w-full min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4 sm:p-6 lg:p-8">
    <p-toast></p-toast>

    <p-card styleClass="w-[900px] max-w-2xl shadow-lg rounded-lg custom-fixed-height-card">
        <ng-template pTemplate="header">
            <div class="text-center p-6 pb-4">
                <div class="mx-auto mb-4 w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center">
                    <i class="pi pi-home h-8 w-8 text-white"></i>
                </div>
                <h2 class="text-2xl font-bold">Configuración Inicial</h2>
                <p class="text-gray-600">Configura tu sistema POS en {{ step }} de 3 pasos</p>
            </div>
        </ng-template>

        <div class="p-6 flex flex-col h-full">
            <div class="flex items-center justify-center space-x-2 mb-6">
                <ng-container *ngFor="let i of [1, 2, 3]">
                    <div class="flex items-center">
                        <div
                            [ngClass]="{
                                'w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium': true,
                                'bg-blue-600 text-white': i <= step,
                                'bg-gray-200 text-gray-600': i > step
                            }"
                        >
                            {{ i }}
                        </div>
                        <div *ngIf="i < 3"
                            [ngClass]="{
                                'w-12 h-1': true,
                                'bg-blue-600': i < step,
                                'bg-gray-200': i >= step
                            }"
                        ></div>
                    </div>
                </ng-container>
            </div>

            <div class="flex-grow overflow-y-auto pr-2 custom-scroll-container"> <div class="space-y-6 pb-4"> <ng-container *ngIf="step === 1">
                        <div class="space-y-6">
                            <div class="text-center mb-6">
                                <i class="pi pi-building mx-auto h-12 w-12 text-blue-600"></i>
                                <h3 class="text-lg font-semibold">Información de la Empresa</h3>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label htmlFor="companyName" class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Empresa *</label>
                                    <input
                                        pInputText
                                        id="companyName"
                                        name="companyName"
                                        [(ngModel)]="setupData.companyName"
                                        (ngModelChange)="handleInputChange('companyName', $event)"
                                        placeholder="Mi Tienda S.A.S"
                                        class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    />
                                    <small *ngIf="!setupData.companyName && (step > 1 || (!isStepValid() && step === 1))" class="block mt-1 text-red-500 text-sm">
                                        El nombre de la empresa es requerido.
                                    </small>
                                </div>
                                <div>
                                    <label htmlFor="businessType" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Negocio *</label>
                                    <input
                                        pInputText
                                        id="businessType"
                                        name="businessType"
                                        [(ngModel)]="setupData.businessType"
                                        (ngModelChange)="handleInputChange('businessType', $event)"
                                        placeholder="Minimercado, Droguería, Supermercado, etc."
                                        class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    />
                                    <small *ngIf="!setupData.businessType && (step > 1 || (!isStepValid() && step === 1))" class="block mt-1 text-red-500 text-sm">
                                        El tipo de negocio es requerido.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="step === 2">
                        <div class="space-y-6">
                            <div class="text-center mb-6">
                                <i class="pi pi-map-marker mx-auto h-12 w-12 text-blue-600"></i>
                                <h3 class="text-lg font-semibold">Información de Contacto</h3>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label htmlFor="address" class="block text-sm font-medium text-gray-700 mb-1">Dirección *</label>
                                    <input
                                        pInputText
                                        id="address"
                                        name="address"
                                        [(ngModel)]="setupData.address"
                                        (ngModelChange)="handleInputChange('address', $event)"
                                        placeholder="Calle 123 #45-67, Ciudad"
                                        class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    />
                                    <small *ngIf="!setupData.address && (step > 2 || (!isStepValid() && step === 2))" class="block mt-1 text-red-500 text-sm">
                                        La dirección es requerida.
                                    </small>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label htmlFor="phone" class="block text-sm font-medium text-gray-700 mb-1">Teléfono *</label>
                                        <input
                                            pInputText
                                            id="phone"
                                            name="phone"
                                            [(ngModel)]="setupData.phone"
                                            (ngModelChange)="handleInputChange('phone', $event)"
                                            placeholder="+57 300 123 4567"
                                            class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                        />
                                        <small *ngIf="!setupData.phone && (step > 2 || (!isStepValid() && step === 2))" class="block mt-1 text-red-500 text-sm">
                                            El teléfono es requerido.
                                        </small>
                                    </div>
                                    <div>
                                        <label htmlFor="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                                        <input
                                            pInputText
                                            id="email"
                                            type="email"
                                            name="email"
                                            [(ngModel)]="setupData.email"
                                            (ngModelChange)="handleInputChange('email', $event)"
                                            placeholder="contacto@mitienda.com"
                                            class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                        />
                                        <small *ngIf="(!setupData.email || !isValidEmail(setupData.email)) && (step > 2 || (!isStepValid() && step === 2))" class="block mt-1 text-red-500 text-sm">
                                            Ingrese un email válido.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="step === 3">
                        <div class="space-y-6">
                            <div class="text-center mb-6">
                                <i class="pi pi-user mx-auto h-12 w-12 text-blue-600"></i>
                                <h3 class="text-lg font-semibold">Información Legal</h3>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label htmlFor="ownerName" class="block text-sm font-medium text-gray-700 mb-1">Nombre del Propietario *</label>
                                    <input
                                        pInputText
                                        id="ownerName"
                                        name="ownerName"
                                        [(ngModel)]="setupData.ownerName"
                                        (ngModelChange)="handleInputChange('ownerName', $event)"
                                        placeholder="Juan Pérez"
                                        class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    />
                                    <small *ngIf="!setupData.ownerName && (step > 3 || (!isStepValid() && step === 3))" class="block mt-1 text-red-500 text-sm">
                                        El nombre del propietario es requerido.
                                    </small>
                                </div>
                                <div>
                                    <label htmlFor="taxId" class="block text-sm font-medium text-gray-700 mb-1">NIT/RUT *</label>
                                    <input
                                        pInputText
                                        id="taxId"
                                        name="taxId"
                                        [(ngModel)]="setupData.taxId"
                                        (ngModelChange)="handleInputChange('taxId', $event)"
                                        placeholder="123456789-0"
                                        class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    />
                                    <small *ngIf="!setupData.taxId && (step > 3 || (!isStepValid() && step === 3))" class="block mt-1 text-red-500 text-sm">
                                        El NIT/RUT es requerido.
                                    </small>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label htmlFor="currency" class="block text-sm font-medium text-gray-700 mb-1">Moneda</label>
                                        <p-dropdown
                                            id="currency"
                                            name="currency"
                                            [options]="currencyOptions"
                                            optionLabel="label"
                                            optionValue="value"
                                            [(ngModel)]="setupData.currency"
                                            (ngModelChange)="handleInputChange('currency', $event)"
                                            styleClass="w-full rounded-md border border-input bg-background text-sm ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                                            inputStyleClass="w-full rounded-md"
                                            panelStyleClass="rounded-md shadow-lg"
                                        ></p-dropdown>
                                    </div>
                                    <div>
                                        <label htmlFor="timezone" class="block text-sm font-medium text-gray-700 mb-1">Zona Horaria</label>
                                        <p-dropdown
                                            id="timezone"
                                            name="timezone"
                                            [options]="timezoneOptions"
                                            optionLabel="label"
                                            optionValue="value"
                                            [(ngModel)]="setupData.timezone"
                                            (ngModelChange)="handleInputChange('timezone', $event)"
                                            styleClass="w-full rounded-md border border-input bg-background text-sm ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                                            inputStyleClass="w-full rounded-md"
                                            panelStyleClass="rounded-md shadow-lg"
                                        ></p-dropdown>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>

            <div class="pt-6">
                <div class="h-px w-full bg-gray-200 mb-6"></div>
                <div class="flex justify-between">
                    <p-button
                        label="Anterior"
                        icon="pi pi-angle-left"
                        styleClass="p-button-outlined"
                        (onClick)="setStep(step - 1)"
                        [disabled]="step === 1"
                    ></p-button>
                    <ng-container *ngIf="step < 3; else completeButton">
                        <p-button
                            label="Siguiente"
                            icon="pi pi-angle-right"
                            iconPos="right"
                            (onClick)="setStep(step + 1)"
                            [disabled]="!isStepValid()"
                        ></p-button>
                    </ng-container>
                    <ng-template #completeButton>
                        <p-button
                            label="Completar Configuración"
                            icon="pi pi-check"
                            styleClass="bg-blue-600 hover:bg-blue-700 text-white"
                            (onClick)="handleComplete()"
                            [disabled]="!isStepValid()"
                        ></p-button>
                    </ng-template>
                </div>
            </div>
        </div>
    </p-card>
</div>